# Save数据存储

**在程序运行的过程当中会产生许多的数据，有些数据是我们希望永久化存储的，然而这些数据都是存储在内存当中的，内存有个特点就是只能保存即时数据，断电后数据消失，也就是说，电脑一关机内存里面的数据就没有了。因此内存不能用作数据的持久化存储，这时学习数据持久化存储的方法就显得特别重要了。**

## 存储方式

其实数据持久化存储的方式总体上就分为两大类：**文件存储、数据库存储**

文件存储：最常见的数据持久化存储方式。

数据库存储：最适用的数据持久化存储方式。

## 文件存储

**平常操作计算机的时候，我们会接触到各种格式的文件，例如图片文件、视频文件、文本文件、音频文件、Word文件、Excel文件、PPT文件等等，其实它们都是数据的载体，都可以用来持久化存储数据，这是因为文件都是存储在硬盘当中的，计算机关机断电不会对硬盘造成影响，这些文件依然存储在硬盘当中。**因此说，文件存储是最常见的数据存储方式。

### 读写操作

用文件来存储数据，肯定不了对文件的读写操作。例如，前面我们学习了二进制文件读写、文本文件读写：

```python
# 文本文件读写
with open('./test1.txt', 'w', encoding='utf-8')as f: # 打开方式'w'，并设置编码格式utf-8
    f.write('疑是地上霜') # 向文件里面写入'疑是地上霜'

with open('./test1.txt', 'r', encoding='utf-8') as f: # 打开方式'r'，并设置编码格式utf-8
    content1 = f.read()       
    print(content1)           # 疑是地上霜
    content2 = f.readline()   
    print(content2)           # 疑是地上霜
    content3 = f.readlines()  
    print(content3)           # ['疑是地上霜']

# 二进制文件读写
with open('./img.jpg', 'rb') as f: # 打开方式'rb'，打开有图像的图片img.jpg，
    image_date = f.read()          # 读取图片的二进制数据
    print(image_date)              # b'\xff\xd8\xff\xe0\...（b开头的二进制流数据）

with open('./lew.jpg', 'wb') as f: # 打开方式'wb'，打开无图像的图片lew.jpg，
    f.write(image_date)	           # 将上面的图片img.jpg的二进制数据写入图片lew.jpg当中
```

**虽然像Word、Excel等文件也能用二进制读写文件的方式打开，但显示的都是无法阅读的二进制流数据，并不是文件通过软件加载后展示的内容。因此，读写不同类型的文件需要选择不同的库和方法，就好比计算机中，我们打开视频文件就会去启动播放器软件来播放，打开网页文件就会去调用浏览器来加载，是一个道理。**

### 简单总结

总体上来说，采用文件来存储数据的方式是最常见的，也是我们必须要掌握的，在后面的章节中会介绍各种类型文件的读写方式。

## 数据库存储

数据库存储数据在日常生活中应用的就更加广泛了，例如：

1. 身份证信息放在公安部的系统
2. 银行卡的余额和交易记录、转帐信息
3. 在酒店的开房信息（所以出现了数据库被盗和信息泄漏）
4. 飞机、火车、汽车联网购票记录
5. QQ聊天记录、网上购物、贴吧、喜欢听的音乐、电影的收藏信息
6. 手机电话机录、余额、公交卡余额、水费、电费、彩票的购买记录
7. 打游戏的装备、等级、魔力、力量、攻击能力等信息

### 优势比较

相比于文件存储来说，数据库存储的优势就很大了。主要在于以下几方面：

1. **数据库的数据存储量比文件存储更大。**
2. 数据库加载数据的速度比打开一个大文件速度更快。
3. **数据库和文件一样都是在硬盘当中，断后不丢失数据。**
4. **易于数据的增、删、改、查操作，能极大的减少了工作量。**
5. **数据库可以很简单的设置密码保护，提高了保护数据的安全性。**

### 连接池技术

**使用数据库就必须要先连接到数据库，其实数据库连接是一种关键的有限的昂贵的资源，这一点在多用户的网页应用程序中体现得尤为突出。**对数据库连接的管理能显著影响到整个应用程序的伸缩性和健壮性，影响到程序的性能指标。

**针对数据库的连接问题，提出了专门负责分配、管理和释放数据库连接的连接池技术，它允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个；释放空闲时间超过最大空闲时间的数据库连接来避免因为没有释放数据库连接而引起的数据库连接遗漏。**应用这项技术能明显提高对数据库操作的性能。

#### 连接池原理

**在系统初始化的时候，将数据库连接作为对象存储在内存中，当用户需要访问数据库时，并非建立一个新的连接，而是从连接池中取出一个已建立的空闲连接对象。使用完毕后，用户也并非将连接关闭，而是将连接放回连接池中，以供下一个请求访问使用。**

**连接的建立、断开都由连接池自身来管理，同时还可以通过设置连接池的参数来控制连接池中的初始连接数、连接的上下限数以及每个连接的最大使用次数、最大空闲时间等等**，也可以通过其自身的管理机制来监视数据库连接的数量、使用情况等。

#### 连接数

**最小连接数：限定连接池中最小数据库连接数量。**数据库连接池在初始化时将创建一定数量的数据库连接放到连接池中，这些数据库连接的数量是由最小数据库连接数制约。无论这些数据库连接是否被使用，连接池都将一直保证至少拥有这么多的连接数量。

**最大连接数：限定连接池中最大数据库连接数量。**如果当应用程序向连接池请求的连接数超过最大连接数量时，这些请求将被加入到等待队列中，这会影响之后的数据库操作。

?> 正常情况下，每次执行方法都会获取或创建一个连接，每次执行完方法都会释放连接，所以都保持最小连接数。但是如果一直没有释放连接，直到超过最大连接数就会报错。

### 简单总结

总体上来说，采用数据库来存储数据的方式是最适合的，同样也是我们必须要掌握的，在公司项目中采用数据库存储数据是必然的选择之路。

