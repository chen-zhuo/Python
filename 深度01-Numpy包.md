# Numpy

最新的NumPy文档可以在[最新（开发）版本](https://www.numpy.org/devdocs)中找到。它包括用户指南、完整的参考文档和开发人员指南，以及元信息和“NumPy增强建议”（其中包括NumPy发展规划和主要新功能的详细计划）。

NumPy官方的中文文档地址：http://www.numpy.org.cn/

### 简介、安装、数组

##### Numpy简介

**NumPy是使用Python进行科学计算的基础包，主要用于对多维数组执行计算，还可以用作通用数据的高效多维容器，可以定义任意数据类型，能够无缝快速地与各种数据库集成。**它包含如下的内容：

- 一个强大的N维数组对象。
- 复杂的（广播）功能。
- 用于集成C / C ++和Fortran代码的工具。
- 有用的线性代数，傅里叶变换和随机数功能。

**NumPy提供了大量的库函数和操作，可以帮助程序员轻松地进行数值计算。**这类数值计算广泛用于以下任务：

- 机器学习模型：在编写机器学习算法时，需要对矩阵进行各种数值计算。例如矩阵乘法、换位、加法等。NumPy提供了一个非常好的库，用于简单(在编写代码方面)和快速(在速度方面)计算。NumPy数组用于存储训练数据和机器学习模型的参数。
- 图像处理和计算机图形学：计算机中的图像表示为多维数字数组。NumPy成为同样情况下最自然的选择。实际上，NumPy提供了一些优秀的库函数来快速处理图像。例如，镜像图像、按特定角度旋转图像等。
- 数学任务：NumPy对于执行各种数学任务非常有用，如数值积分、微分、内插、外推等。因此，当涉及到数学任务时，它形成了一种基于Python的MATLAB的快速替代。

##### Numpy安装

安装NumPy的最快也是最简单的方法是在shell上使用以下命令：

```
pip install numpy
```

##### NumPy数组

Numpy导入有一个约定俗成：**会将 `numpy` 重命名为 `np`，即使是官方文档也是这样写的，可能是为了偷懒少打几个字符吧。**

```
import numpy as np
```

**NumPy提供的最重要的数据结构就是 `NumPy数组`，相当于是对Python数据结构的扩展。**

```python
import numpy as np

print(type([1, 2, 3, 4, 5]))           # <class 'list'>
print(type((1, 2, 3, 4, 5)))           # <class 'tuple'>
print(type(np.array([1, 2, 3, 4, 5]))) # <class 'numpy.ndarray'>
print(type(np.array((1, 2, 3, 4, 5)))) # <class 'numpy.ndarray'>
```

### 简单入门

NumPy是科学Python成功的关键之一，前面提到“数组”是Numpy的特色，**不仅如此Numpy的许多底层函数是用C编写，因此运算速度非常快，你可以体验在原生Python中永远无法体验到的速度。如果你想要进入Python中的数据科学和/或机器学习，你就要必须学习它。**

##### 矢量和矩阵

矢量：**具有方向和幅度的量，通常用于表示速度，加速度和动量等事物。**向量可以用多种方式编写，如（1,4,6,9）就是我们在NumPy中表示他们的方式，即一维向量。

矩阵：**与矢量类似，由行和列组成，很像一个网格，可以通过给出它所在的行和列来引用矩阵中的值。**在NumPy中，我们通过传递一系列序列来制作数组，就像我们之前所做的那样。

![简单线性代数图示](http://www.numpy.org.cn/static/images/article/numpy_maths1-1.jpg)

##### 一维数组

创建一个一维数组的方法：

```python
import numpy as np

print(np.array([0, 1, 2, 3, 4]))    # [0 1 2 3 4]
print(np.array((0, 1, 2, 3, 4)))    # [0 1 2 3 4]
print(np.arange(5))                 # [0 1 2 3 4]
# linspace均匀分布5个0到2个π之间的值
print(np.linspace(0, 2*np.pi, 5))   # [0.         1.57079633 3.14159265 4.71238898 6.28318531]
'''
解释：上面的代码显示了创建数组的4种不同方法。最基本的方法是将序列传递给NumPy的array()函数; 你可以传递任何序列（类数组）。
'''
```

?> 当我们打印具有不同长度数字的数组时，它会自动将它们填充出来，方便对于矩阵的查看。

NumPy数组配备了大量的函数和运算符，可以帮助我们快速编写上面讨论过的各种类型计算的高性能代码。

```python
# 使用import numpy作为np导入NumPy库
import numpy as np
# 创建一个自定义的NumPy数组
my_array = np.array([1, 2, 3, 4, 5])
# 打印numpy数组
print(my_array)                 # [1 2 3 4 5]
# 以下标打印数组，起始索引编号为0
print(my_array[0])              # 1
print(my_array[1])              # 2
# 以下标修改NumPy数组的元素
my_array[0] = -1
print(my_array)                 # [-1  2  3  4  5]
# 获取数组形状
print(my_array.shape)           # (5,) 意思就是my_array是一个包含5个元素的数组
# 创建长度为5，元素都为1的数组
print(np.zeros((5)))            # [0. 0. 0. 0. 0.]
# 创建长度为5，元素都为1的数组
print(np.ones((5)))             # [1. 1. 1. 1. 1.]
# 创建长度为5，元素都为0到1之间的随机值的数组
print(np.random.random((5)))    # [0.57997992 0.72557397 0.96131217 0.46233505 0.42741732]
```

##### 多维数组

创建一个2D（二维）数组，就要传递一个列表的列表（或者是一个序列的序列）给array()函数。

创建一个3D（三维）数组，就要传递一个列表的列表的列表。

创建一个4D（四维）数组，就要传递一个列表的列表的列表的列表，以此类推。

```python
import numpy as np

# 参数(2, 3)表示2行，3列
print(np.zeros((2, 3)))
'''
输出：
[[0. 0. 0.]
 [0. 0. 0.]]
'''

# 参数(2, 4)表示2行，4列
print(np.ones((2, 4)))
'''
输出：
[[1. 1. 1. 1.]
 [1. 1. 1. 1.]]
'''

# eye函数返回的是一个二维2的数组(N,M)，对角线的地方为1，其余的地方为0.
print(np.eye(2))
'''
输出：
[[1. 0.]
 [0. 1.]]
'''

# 参数(2, 2)表示2行，2列，以7填充
print(np.full((2,2), 7))
'''
输出：
[[7 7]
 [7 7]]
'''

# 将一维数组改变形状为2行，2列的数组
print(np.array([5.0, 6.0, 7.0, 8.0]).reshape((2,2)))
'''
输出：
[[5. 6.]
 [7. 8.]]
'''

# 创建一个自定义的二维数组
my_array = np.array([[4, 5], [6, 1]])
print(my_array)
'''
输出：
[[4 5]
 [6 1]]
'''
# 获取数组形状
print(my_array.shape)   # (2, 2) 表示数组中有2行2列。
# 获取第一行的所有列，冒号:代表所有
print(my_array[0, :])   # [4 5]
# 获取所有行的第一列，冒号:代表所有
print(my_array[:, 1])   # [5 1]
# [i][j]或[i, j]符号来索引，其中i表示行号，j表示列号，i和j都从0开始
print(my_array[0][1])   # 5
```

##### 数组属性

```python
import numpy as np

a = np.array([[11, 12, 13, 14, 15],
              [16, 17, 18, 19, 20],
              [21, 22, 23, 24, 25],
              [26, 27, 28 ,29, 30],
              [31, 32, 33, 34, 35]])
# 获取类型
print(type(a))    # <class 'numpy.ndarray'>
# 数组的维数
print(a.ndim)     # 2，即数组是2维数组
# 数组形状
print(a.shape)    # (5, 5)，表示数组中有5行5列。
# 数据大小
 print(a.size)    # 25，即5行*5列=25项
# 数据类型
print(a.dtype)    # int32，即32位整数(32bit integer)，相当于int，占4个字节
# 每个项占用的字节数
print(a.itemsize) # 4，上面给出了int32，每个项占用4个字节
# 数组中的所有数据消耗掉的字节数
print(a.nbytes)   # 100，整个数据占用25项*4字节=100字节
```

##### 运算符、逻辑符

```python
import numpy as np

a = np.arange(1,5).reshape((2, 2))
print(a)
'''
输出：
[[1 2]
 [3 4]]
'''
b = np.array([5.0, 6.0, 7.0, 8.0]).reshape((2,2))
print(b)
'''
输出：
[[5. 6.]
 [7. 8.]]
'''
print(a + b)
'''
输出：
[[ 6.  8.]
 [10. 12.]]
'''
print(a - b)
'''
输出：
[[-4. -4.]
 [-4. -4.]]
'''
print(a * b)
'''
输出：
[[ 5. 12.]
 [21. 32.]]
'''
print(a / b)
'''
输出：
[[0.2        0.33333333]
 [0.42857143 0.5       ]]
'''
print(a ** 2)
'''
输出：
[[ 1  4]
 [ 9 16]]
'''
# 这些操作符都是对数组进行逐元素运算。比如 (a, b, c) + (d, e, f) 的结果就是 (a+d, b+e, c+f)。它将分别对每一个元素进行配对，然后对它们进行运算。
print(a < b)
'''
输出：
[[ True  True]
 [ True  True]]
'''
print(a > b)
'''
输出：
[[False False]
 [False False]]
'''
# 使用逻辑运算符比如 “<” 和 “>” 的时候，返回的将是一个布尔型数组
```

##### 数组索引

**普通索引**：根据下标或者行号和列号的组合进行索引。

```python
a = np.array([[11, 12, 13, 14, 15],
              [16, 17, 18, 19, 20],
              [21, 22, 23, 24, 25],
              [26, 27, 28 ,29, 30],
              [31, 32, 33, 34, 35]])
# 索引
print(a[2,4]) # 25
'''
解释：2D（二维）数组是按行和列排列的。要索引2D（二维）数组，我们只需引用行数和列数即可。
'''
```

**花式索引**：是获取数组中我们想要的特定元素的有效方法。

```python
# arange根据参数给的范围和步长，生成数组
a = np.arange(0, 100, 10)
print(a) # [ 0 10 20 30 40 50 60 70 80 90]

# [1, 5, -1]都是下标位置
b = a[[1, 5, -1]]
print(b) # [10 50 90]
```

**缺省索引**：不完全索引是从多维数组的第一个维度获取索引或切片的一种方便方法。

```python
a = np.arange(0, 100, 10)
print(a) # [ 0 10 20 30 40 50 60 70 80 90]

b = a[:5]
print(b) # [ 0 10 20 30 40]

c = a[a >= 50]
print(c) # [50 60 70 80 90]
```

**布尔屏蔽**：它允许我们根据我们指定的条件检索数组中的元素。

```python
import matplotlib.pyplot as plt

# 0到2个π值之间，均匀分出50点
a = np.linspace(0, 2 * np.pi, 50)
# b是a正弦曲线
b = np.sin(a)
plt.plot(a,b)
# b值大于等于0
mask = b >= 0
plt.plot(a[mask], b[mask], 'bo')
# b值大于等于0，且a值必须小于等于π的2分之一
mask = (b >= 0) & (a <= np.pi / 2)
plt.plot(a[mask], b[mask], 'go')
plt.show()
```

我们利用这些条件来选择图上的不同点。蓝色点(在图中还包括绿点，但绿点掩盖了蓝色点)，显示值大于0的所有点。绿色点表示值大于0且小于一半π的所有点。

![布尔掩码结果图](http://www.numpy.org.cn/static/images/article/numpy_masking-1.png)

##### 数组切片

```python
a = np.array([[11, 12, 13, 14, 15],
              [16, 17, 18, 19, 20],
              [21, 22, 23, 24, 25],
              [26, 27, 28 ,29, 30],
              [31, 32, 33, 34, 35]])
# 切片
print(a[0, 1:4])  # >>>[12 13 14]
print(a[1:4, 0])  # >>>[16 21 26]
print(a[::2,::2]) # >>>[[11 13 15]
                  #     [21 23 25]
                  #     [31 33 35]]
print(a[:, 1])    # >>>[12 17 22 27 32]
'''
解释：切片多维数组比1D数组复杂一点，对于2D数组，我们的第一片定义了行的切片，第二片定义了列的切片。
'''
```

![numpy数组切片工作原理](http://www.numpy.org.cn/static/images/article/numpy_2D_slicing_diagram-1.jpg)

```python
a = np.array([[1,2,3,4], 
              [5,6,7,8], 
              [9,10,11,12]])

row_r1 = a[1, :]
print(row_r1, row_r1.shape)  # >>>[5 6 7 8] (4,)
row_r2 = a[1:2, :]
print(row_r2, row_r2.shape)  # >>>[[5 6 7 8]] (1, 4)

col_r1 = a[:, 1]
print(col_r1, col_r1.shape)  # >>>[ 2  6 10] (3,)
col_r2 = a[:, 1:2]
print(col_r2, col_r2.shape)  # >>>[[ 2]
                             #     [ 6]
                             #     [10]] (3, 1)
```

##### 数组可变性

**数组属于可变对象，即内存地址(`id`)不变的情况下，可以被改变对象，通俗点说就是原地改变。**

```python
a = np.array([[1, 2, 3, 4],
              [5, 6, 7, 8],
              [9,10,11,12]])
# 变量a为数组，获取里面的id值
print(a)           # >>>[[ 1  2  3  4]
                   #     [ 5  6  7  8]
                   #     [ 9 10 11 12]]
print(a[0, 1])     # >>>2
print(id(a))       # >>>1770155072208

# 对a数组进行切片产生新对象b，并重新赋值
b = a[:2, 1:3]
print(b)           # >>>[[2 3]
                   #     [6 7]]
b[0, 0] = 77
print(b)           # >>>[[77  3]
                   #     [ 6  7]]
print(id(b))       # >>>1770155729904

# a数组的值变化，但a数组的id不变，说明为可变对象
print(a)           # >>>[[ 1 77  3  4]
                   #     [ 5  6  7  8]
                   #     [ 9 10 11 12]]
print(a[0, 1])     # >>>77
print(id(a))       # >>>1770155072208
```

##### 数组函数

```python
a = np.arange(10)

# 所有元素相加
print(a.sum())    # 45
# 最小元素
print(a.min())    # 0
# 最大元素
print(a.max())    # 9
# 将前两个元素的和做为第三个元素的加数，对数组中的所有元素执行此操作，并返回作为列表的数组之和的运行总数。
print(a.cumsum()) # [ 0  1  3  6 10 15 21 28 36 45]
```

**`dot()`函数**：称为点积，它返回的是一个标量（只有大小没有方向的一个值）而不是数组。

![点积运算原理](http://www.numpy.org.cn/static/images/article/numpy_maths2-1.jpg)

```python
a = np.array([1, 2, 3])
b = np.array([1, 2, 3])
print(a.dot(b))
'''
输出：
14，即1*1+2*2+3*3=14
'''
```

**`where()`函数**：根据条件返回数组中的值的有效方法。只需要把条件传递给它，它就会**返回一个使得条件为真的元素的下标的列表**。

```python
a = np.arange(0, 100, 10)
print(a) # [ 0 10 20 30 40 50 60 70 80 90]

b = np.where(a < 50)
print(b) # (array([0, 1, 2, 3, 4], dtype=int64),)

c = np.where(a >= 50)[0]
print(c) # [5 6 7 8 9]，数值就是符合条件的元素的下标
```

















